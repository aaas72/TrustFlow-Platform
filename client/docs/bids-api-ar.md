# ملخص الـ API الخاص بعروض المشاريع (Bids)

- جميع المسارات تحت `/api/bids` وتحتاج مصادقة (`Authorization: Bearer <token>`).
- الحقول الأساسية في العرض: `id`, `project_id`, `freelancer_id`, `amount`, `proposal`, `delivery_time`, `status`, `created_at`.
- بعد قبول عرض: المشروع يُحدّث إلى `status='in_progress'` ويتم رفض بقية العروض تلقائيًا.

## إرسال عرض

- المسار: `POST /api/bids`
- الغرض: يرسل مستقل عرضًا إلى مشروع.
- الصلاحيات: فقط مستقل (`user_type === 'freelancer'`).
- جسم الطلب:
  - `project_id` رقم المشروع
  - `amount` المبلغ
  - `proposal` نص العرض
  - `delivery_time` مدة التسليم (اختياري، تُخزّن كنص)
- الاستجابة:
  - `{ success: true, message: "Teklif başarıyla gönderildi!", bid_id: <number> }`
- أخطاء شائعة:
  - `403` إذا لم تكن مستقلًا
  - `400` إذا كانت الحقول ناقصة
  - `409` إذا سبق وقدمت عرضًا لنفس المشروع

## قبول عرض

- المسار: `PUT /api/bids/:bid_id/accept`
- الغرض: يقبل عميل عرضًا لمشروعه ويبدأ التنفيذ.
- الصلاحيات: فقط عميل مالك المشروع المرتبط بالعرض.
- المعاملات: `:bid_id` رقم العرض المراد قبوله
- الجسم: بدون جسم (وإذا أرسلت `bid_id` في الجسم يجب أن يطابق الذي في الرابط)
- الاستجابة:
  - `{ success: true, message: "Teklif başarıyla kabul edildi ve proje başladı" }`
- أخطاء شائعة:
  - `403` إذا لم تكن مالك المشروع
  - `400` إذا العرض مقبول مسبقًا أو المشروع لديه عرض مقبول
  - `400` إذا `bid_id` غير صالح أو متعارض مع جسم الطلب

## عروض مشروع محدّد

- المسار: `GET /api/bids/project/:project_id`
- الغرض: يعرض جميع العروض الخاصة بمشروع.
- الصلاحيات: فقط عميل مالك المشروع.
- المعاملات: `:project_id` رقم المشروع
- الاستجابة:
  - `{ success: true, bids: BidItem[] }`
  - كل `BidItem` قد يحتوي `freelancer_name` و `project_title` حسب الاستعلام الحالي
- أخطاء شائعة:
  - `403` إذا لم تكن مالك المشروع
  - `404` إذا لم يوجد المشروع

## عروض مستقل محدّد

- المسار: `GET /api/bids/freelancer/:freelancer_id`
- الغرض: يعرض جميع عروض مستقل معيّن.
- الصلاحيات: فقط نفس المستقل (`req.user.id === :freelancer_id`).
- المعاملات: `:freelancer_id` رقم المستقل
- الاستجابة:
  - `{ success: true, bids: BidItem[] }`
- أخطاء شائعة:
  - `403` إذا حاول مستخدم آخر الاطلاع

## عروضي/عروض مشاريعي (حسب نوع المستخدم)

- المسار: `GET /api/bids`
- الغرض: قائمة مختصرة مفلترة حسب الدور:
  - إذا كنت عميلًا: يعرض عروض مشاريعك.
  - إذا كنت مستقلًا: يعرض عروضك أنت.
- الاستجابة:
  - `{ success: true, bids: BidItem[] }`
- أخطاء شائعة:
  - `403` إذا كان نوع المستخدم غير مدعوم

## ملاحظات مهمة للفرونت إند

- بعد قبول عرض:
  - حدّث واجهة المشروع: حالة المشروع تصبح `in_progress`.
  - حدّث قائمة العروض: العرض المقبول يصبح `accepted` والبقية `rejected`.
- استخدم مسار المشروع للعميل ومسار المستقل للمستقل لضمان التوافق مع التحقق من الملكية.
- أنواع بيانات الواجهة المقترحة (مشابهة للموجود في `client/src/services/bidService.ts`):
  - `BidItem`: يحتوي `id`, `project_id`, `freelancer_id`, `amount`, `proposal`, `delivery_time`, `status`, `created_at`, وأحيانًا `freelancer_name`, `project_title`.
  - استجابات القوائم دائمًا على شكل `{ success: boolean, bids: BidItem[] }`.
